<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Password-Protected QR Link Generator</title>
  <meta name="viewport" content="width=360, initial-scale=1.0">
  <script src="https://cdn.jsdelivr.net/npm/qrcode@1.5.3/build/qrcode.min.js"></script>
  <style>
    body { font-family: Arial, sans-serif; background: #f8fafd; }
    .container { max-width:400px; margin:50px auto; background:#fff; border-radius:12px; box-shadow:0 6px 32px #0002; padding:28px;}
    h2 { text-align:center; }
    label { font-weight:bold; display:block; margin-top:10px;}
    input[type="text"], input[type="password"] { width:100%;padding:9px;border-radius:6px;border:1px solid #bbb;margin:7px 0 12px 0;}
    button {background:#2e7d32;color:#fff;border:none;padding:10px 24px;font-size:18px;border-radius:6px;cursor:pointer;}
    button:hover {background:#135b1b;}
    #qrcode {margin:24px auto;display:flex;justify-content:center;}
    .note {font-size:13px;color:#777;margin-bottom:16px;}
    #downloadBtn, #viewBtn {display:none;margin:0 10px 24px 0;}
    #qr-btns {text-align:center;}
    /* Popup */
    #qrModal {
      display:none; position:fixed;top:0;left:0;width:100vw;height:100vh;background:rgba(0,0,0,0.7);z-index:1000;
      align-items:center; justify-content:center;
    }
    #qrModalContent {
      background:#fff; border-radius:18px; padding:20px; box-shadow:0 4px 32px #0006; text-align:center;
      position:relative;
      max-width:95vw;
    }
    #qrModalContent canvas { width:330px !important; height:330px !important;}
    #qrModalClose {
      position:absolute;top:10px;right:20px;font-size:30px;color:#e64a19;cursor:pointer;font-weight:bold;background:none;border:none;
    }
  </style>
</head>
<body>
<div class="container" id="mainGen">
  <h2>QR Code Generator with Password</h2>
  <label>Link/URL to protect:</label>
  <input type="text" id="link" placeholder="https://example.com" autocomplete="off">
  <label>Password to unlock:</label>
  <input type="password" id="pw" placeholder="Set a password" autocomplete="off">
  <div class="note">When scanned, the QR code opens a password prompt before redirecting.</div>
  <button onclick="generateQR()">Generate QR Code</button>
  <div id="qrcode"></div>
  <div id="qr-btns">
    <button id="viewBtn" onclick="viewQR()">üëÅ View QR</button>
    <button id="downloadBtn" onclick="downloadQR()">‚¨á Download as PNG</button>
  </div>
  <div id="qr-result" style="word-break:break-all;"></div>
</div>

<!-- Modal Popup -->
<div id="qrModal">
  <div id="qrModalContent">
    <button id="qrModalClose" onclick="closeModal()">&times;</button>
    <div id="modalQR"></div>
    <div style="margin-top:12px;color:#777;">Long press or right-click to save</div>
  </div>
</div>

<div class="container" id="pwPrompt" style="display:none;">
  <h2>Password Required</h2>
  <p>Enter the password to access this link.</p>
  <input type="password" id="pwTry" placeholder="Enter password">
  <button onclick="checkPassword()">Unlock</button>
  <div id="pwMsg" style="margin-top:14px;color:#d33;font-weight:bold;"></div>
</div>
<script>
//--- Crypto functions for simple password protection ---
function xorEncrypt(str, key) {
  return btoa([...str].map((c,i)=>String.fromCharCode(c.charCodeAt(0)^key.charCodeAt(i%key.length))).join(''));
}
function xorDecrypt(data, key) {
  try {
    return atob(data).split('').map((c,i)=>String.fromCharCode(c.charCodeAt(0)^key.charCodeAt(i%key.length))).join('');
  } catch {
    return "";
  }
}

let lastURL = '';
//--- QR Code Generator ---
function generateQR() {
  let link = document.getElementById('link').value.trim();
  let pw = document.getElementById('pw').value;
  if (!/^https?:\/\//i.test(link)) return alert("Enter a valid link starting with http:// or https://");
  if (!pw) return alert("Enter a password!");
  let cipher = xorEncrypt(link, pw);
  let url = location.origin + location.pathname + "?q=" + encodeURIComponent(cipher);
  lastURL = url;
  // Clear previous
  document.getElementById('qrcode').innerHTML = "";
  document.getElementById('modalQR').innerHTML = "";
  // Render main QR (small)
  QRCode.toCanvas(document.createElement('canvas'), url, {width:220}, (err, canvas) => {
    if (!err) {
      document.getElementById('qrcode').appendChild(canvas);
      document.getElementById('downloadBtn').style.display = 'inline-block';
      document.getElementById('viewBtn').style.display = 'inline-block';
    }
  });
  document.getElementById('qr-result').innerHTML = `<b>QR Link:</b> <br><a href="${url}" target="_blank">${url}</a>`;
}
function downloadQR() {
  let canvas = document.querySelector('#qrcode canvas');
  if (!canvas) return alert("No QR generated yet!");
  let link = document.createElement('a');
  link.download = "qr-code.png";
  link.href = canvas.toDataURL();
  link.click();
}
function viewQR() {
  // Render a large QR in modal
  document.getElementById('qrModal').style.display = "flex";
  document.getElementById('modalQR').innerHTML = "";
  if (lastURL) {
    QRCode.toCanvas(document.createElement('canvas'), lastURL, {width:330}, (err, canvas) => {
      if (!err) document.getElementById('modalQR').appendChild(canvas);
    });
  }
}
function closeModal() {
  document.getElementById('qrModal').style.display = "none";
}

//--- QR code scan handler ---
function checkPassword() {
  let pwTry = document.getElementById("pwTry").value;
  let q = new URLSearchParams(location.search).get("q");
  let link = xorDecrypt(q, pwTry);
  if (/^https?:\/\//i.test(link)) {
    document.getElementById("pwMsg").style.color="#28a745";
    document.getElementById("pwMsg").textContent = "Unlocked! Redirecting‚Ä¶";
    setTimeout(()=>{ location.href=link },900);
  } else {
    document.getElementById("pwMsg").textContent = "Wrong password!";
    document.getElementById("pwMsg").style.color="#d33";
  }
}
//--- Check for QR code access mode ---
if (new URLSearchParams(location.search).get("q")) {
  document.getElementById("mainGen").style.display = "none";
  document.getElementById("pwPrompt").style.display = "block";
}
</script>
</body>
</html>
